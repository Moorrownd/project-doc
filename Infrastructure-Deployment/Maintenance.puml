@startuml P2P_Parking_Sharing.Maintenance.Deployment
title P2P Parking Sharing — Maintenance & Deployment

start

partition "Постоянный мониторинг системы" {

  :Мониторинг контейнеров Docker\n(CPU, RAM);
  :Мониторинг API\n(Response time < 1–2с);
  :Мониторинг MySQL\n(соединения, блокировки);
  :Проверка логов Symfony\n(errors / warnings);

}

if (Обнаружена высокая нагрузка?) then (да)

  :Увеличение ресурсов контейнера\n(PHP-FPM / Web);
  :Оптимизация SQL-запросов;
  :Очистка кэша приложения;

elseif (Ошибки API / 5xx?) then (да)

  :Анализ логов Symfony;
  if (Ошибка БД?) then (да)
    :Проверка MySQL;
    :Перезапуск контейнера БД;
  else (нет)
    :Перезапуск контейнера backend;
  endif

else (Система стабильна)
endif

partition "Регулярное обслуживание (ежедневно / ночью)" {

  :Автоматический backup MySQL;
  :Проверка целостности данных;
  :Очистка устаревших логов;
  :Проверка свободного места на диске;

}

partition "Развертывание обновлений" {

  :Сборка Docker-образа;
  :Прогон автоматических тестов\n(PHPUnit);
  if (Тесты пройдены?) then (да)
    :Остановка старого контейнера;
    :Развертывание нового контейнера;
    :Применение миграций БД;
  else (нет)
    :Отмена деплоя;
  endif

}

partition "Аварийные ситуации" {

  if (Недоступен внешний сервис?) then (да)
    :Логирование ошибки;
    :Повтор запроса / graceful degradation;
  endif

  if (Сбой платежей?) then (да)
    :Блокировка операций бронирования;
    :Уведомление оператора системы;
  endif

}

stop
@enduml