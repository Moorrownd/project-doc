@startuml P2P_Parking_Sharing.Maintenance
!theme vibrant

title "P2P Parking Sharing — Maintenance & Operations"


package "Docker Infrastructure" as docker_infra {
  [Docker Host] as docker
  [Backend Container\n(PHP / Symfony)] as backend_container
  [MySQL Container] as db_container
}


package "Обслуживание системы" as maintenance {

    actor "Системный администратор" as sys_admin

    package "Система мониторинга" as monitoring {
        [Prometheus] as prometheus
        [Grafana] as grafana
    }

    [Система логирования\n(Symfony Logs)] as logging
    [Система резервного копирования\n(MySQL Backups)] as backup
}


package "Внешние сервисы" as external {

    package "Уведомления администратору" as alerts {
        [Email] as email
        [Telegram] as telegram
    }

    [Платёжный сервис] as payment_gateway
    [Картографический сервис] as map_service
}

package "Разработка и CI/CD" as dev {

    actor "Разработчик" as developer
    [Git Repository\n(GitHub / GitLab)] as git

    package "CI/CD Pipeline" as cicd {
        [Build Stage] as build
        [Test Stage\n(PHPUnit)] as test
        [Deploy Stage] as deploy
    }

    [Docker Registry] as registry
}


sys_admin --> grafana : Просмотр состояния системы
grafana --> prometheus : Метрики (CPU, RAM, API, DB)
prometheus --> alerts : Алерты при сбоях

prometheus --> backend_container : Health checks
prometheus --> db_container : DB metrics
logging --> sys_admin : Ошибки и предупреждения


backup --> db_container : Backup / Restore MySQL
sys_admin --> backup : Контроль бэкапов


developer --> git : PUSH коммитов
git --> build : Триггер pipeline
build --> test : Запуск тестов
test --> registry : Сборка и PUSH Docker-образа
registry --> deploy : PULL образа
deploy --> docker : Обновление контейнера
docker --> backend_container : Перезапуск backend


backend_container --> payment_gateway : HTTPS API
backend_container --> map_service : HTTPS API

@enduml
